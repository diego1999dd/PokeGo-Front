<div class="min-h-screen bg-gray-50 p-6">
  <header class="bg-orange-600 p-4 shadow-md">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <h1 class="text-3xl font-bold text-white">Pokédex Digital</h1>
      <button
        (click)="authService.logout()"
        class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded transition duration-150"
        title="Sair da aplicação"
      >
        Sair
      </button>
    </div>
  </header>

  <main class="max-w-7xl mx-auto mt-6">
    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Pokémon Descobertos</h2>

    <!-- NOVO: Botões de Filtro -->
    <div class="flex space-x-4 mb-6 overflow-x-auto pb-2">
      <!-- Botão Todos -->
      <button
        (click)="setFilter('all')"
        [ngClass]="{
          'bg-blue-600 text-white shadow-lg': currentFilter === 'all',
          'bg-white text-gray-700 hover:bg-gray-100': currentFilter !== 'all'
        }"
        class="px-4 py-2 rounded-lg font-semibold shadow transition duration-150 whitespace-nowrap"
      >
        Todos ({{ pokemonList?.length || 0 }})
      </button>

      <!-- Botão Favoritos (Requisito 3) -->
      <button
        (click)="setFilter('favorites')"
        [ngClass]="{
          'bg-yellow-500 text-white shadow-lg': currentFilter === 'favorites',
          'bg-white text-gray-700 hover:bg-gray-100': currentFilter !== 'favorites'
        }"
        class="px-4 py-2 rounded-lg font-semibold shadow transition duration-150 whitespace-nowrap"
      >
        Favoritos ({{ pokemonList?.filter(p => p.favorito).length || 0 }})
      </button>

      <!-- Botão Equipe de Batalha (Requisito 4) -->
      <button
        (click)="setFilter('team')"
        [ngClass]="{
          'bg-green-600 text-white shadow-lg': currentFilter === 'team',
          'bg-white text-gray-700 hover:bg-gray-100': currentFilter !== 'team'
        }"
        class="px-4 py-2 rounded-lg font-semibold shadow transition duration-150 whitespace-nowrap"
      >
        Equipe de Batalha ({{ pokemonList?.filter(p => p.grupo_batalha).length || 0 }})
      </button>
    </div>

    <!-- Mensagem de Erro -->
    <div *ngIf="errorMessage" class="p-4 bg-red-100 border-l-4 border-red-500 text-red-700">
      <p>{{ errorMessage }}</p>
    </div>

    <!-- Container da Listagem (Grid com Tailwind) -->
    <div
      *ngIf="filteredPokemonList && filteredPokemonList.length > 0"
      class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"
    >
      <!-- Loop sobre a lista FILTRADA -->
      <div
        *ngFor="let pokemon of filteredPokemonList"
        class="bg-white rounded-xl shadow-lg transition duration-300 transform hover:scale-[1.02] overflow-hidden border-2 cursor-pointer"
        [ngClass]="{
          'border-yellow-500 ring-2 ring-yellow-300': pokemon.favorito,
          'border-red-500 ring-2 ring-red-300': pokemon.grupo_batalha,
          'border-gray-200 hover:shadow-xl': !pokemon.favorito && !pokemon.grupo_batalha
        }"
      >
        <!-- Card de Pokémon -->
        <div class="p-4 flex flex-col items-center relative">
          <!-- Botões de Ação -->
          <div class="absolute top-2 right-2 flex space-x-2">
            <!-- Favorito -->
            <button
              (click)="toggleFavorite(pokemon)"
              class="p-2 rounded-full transition duration-150"
              [ngClass]="{
                'text-red-500 hover:text-red-700': pokemon.favorito,
                'text-gray-400 hover:text-red-300': !pokemon.favorito
              }"
              title="{{ pokemon.favorito ? 'Remover dos Favoritos' : 'Adicionar aos Favoritos' }}"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="currentColor"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                />
              </svg>
            </button>

            <!-- Grupo de Batalha -->
            <button
              (click)="toggleTeam(pokemon)"
              class="p-2 rounded-full transition duration-150"
              [ngClass]="{
                'text-blue-600 hover:text-blue-800': pokemon.grupo_batalha,
                'text-gray-400 hover:text-blue-300': !pokemon.grupo_batalha
              }"
              title="{{
                pokemon.grupo_batalha
                  ? 'Remover da Equipe de Batalha'
                  : 'Adicionar à Equipe de Batalha (Max 6)'
              }}"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="currentColor"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 20h5v-5a5 5 0 00-5-5h-1a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 00-1-1h-1zM7 8h5M7 12h5m-5 4h5M17 8h-5M7 8h5M7 12h5M7 16h5"
                />
              </svg>
            </button>
          </div>

          <!-- Imagem e Nome -->
          <img
            [src]="pokemon.imagem_url"
            [alt]="pokemon.nome"
            class="w-28 h-28 object-contain mb-2"
          />
          <h3 class="text-xl font-bold text-gray-900 mt-2">
            {{ pokemon.nome }} (#{{ pokemon.codigo }})
          </h3>

          <!-- Tipos -->
          <div class="flex space-x-2 mt-2">
            <span
              *ngFor="let type of pokemon.tipos"
              class="text-xs font-semibold px-2 py-0.5 rounded-full text-white"
              [ngClass]="{
                'bg-green-600': type === 'grass',
                'bg-red-600': type === 'fire',
                'bg-blue-600': type === 'water',
                'bg-gray-400': type === 'normal',
                'bg-yellow-500': type === 'electric',
                'bg-purple-600': type === 'poison'
              }"
            >
              {{ type }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Caso a lista esteja vazia -->
    <div *ngIf="!pokemonList" class="text-center p-10 text-gray-500">Carregando Pokémon...</div>
    <div
      *ngIf="pokemonList && filteredPokemonList.length === 0"
      class="text-center p-10 text-gray-500"
    >
      Nenhum Pokémon encontrado neste filtro.
    </div>
  </main>
</div>
